!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports):"function"==typeof define&&define.amd?define(["exports"],a):a((e="undefined"!=typeof globalThis?globalThis:e||self).aloneLoader={})}(this,(function(e){"use strict";function a(e){const a=e.toString();let t=2166136261;for(let e=0;e<a.length;e++)t^=a.charCodeAt(e),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function t(e,t=e=>e){return new class{constructor(e){this.name=e,window.aloneFrameLoaderCacheDataList=window.aloneFrameLoaderCacheDataList||{},!window.aloneFrameLoaderCacheDataList[this.name]&&this.del()}get(e){const a={...{...window.aloneFrameLoaderCacheDataList[this.name]||{}}.blob||{}};return e?a[e]||e:a}set(e,t){const o=typeof e;return"object"===o?Array.isArray(e)?e.forEach((e=>this.set(e))):Object.entries(e).forEach((([e,a])=>this.set(e,a))):"function"===o?this.set((e.name||"callback")+"-"+a(e),e):"string"!==o&&"number"!==o||window.aloneFrameLoaderCacheDataList[this.name].list.push({alias:e,value:void 0!==t?t:e}),this}del(){return window.aloneFrameLoaderCacheDataList[this.name]={list:[],blob:{}},this}async load(e=(e,a)=>null,a=1,o=0){e="function"==typeof e?e:()=>null;const{list:s=[]}=window.aloneFrameLoaderCacheDataList[this.name]||{},n=s.reduceRight(((e,a)=>(!e.some((e=>e.alias===a.alias))&&e.unshift(a),e)),[]),i=n.length;if(i>0){const s=Array(i).fill(0),r=(a,t)=>{const o=s.reduce(((e,a)=>e+a),0)/i,n=Math.min(100,100*o).toFixed(2);e(n,{type:a,...t})},l=async(e,a)=>{o>0&&await new Promise((e=>setTimeout(e,o)));try{if("string"==typeof e.value){window.aloneFrameLoaderCacheDataList[this.name].blob[e.alias]=e.value;const o=await(n=e.value,i=t=>{t.lengthComputable&&(s[a]=t.loaded/t.total,r("progress",{alias:e.alias,data:t}))},new Promise((e=>{const a=new XMLHttpRequest;a.timeout=2e4,a.responseType="blob",a.open("GET",n,!0),a.onerror=()=>e({code:a.status,msg:`Network Error (${a.statusText})`}),a.ontimeout=()=>e({code:a.status,msg:`Request Timeout (${a.statusText})`}),"function"==typeof i&&(a.onprogress=e=>i(e)),a.onloadend=()=>200===a.status?e({code:200,msg:"success",body:a.response}):e({code:a.status,msg:`Unknown Error (${a.statusText})`}),(("function"==typeof t?t:e=>e)(a)||a).send()})));if(200===o.code){const a=URL.createObjectURL(o.body);window.aloneFrameLoaderCacheDataList[this.name].blob[e.alias]=a,r("loading",{alias:e.alias,data:a})}else r("error",{alias:e.alias,data:o.msg})}else if("function"==typeof e.value){const a=await e.value();window.aloneFrameLoaderCacheDataList[this.name].blob[e.alias]=a,r("loading",{alias:e.alias,data:a})}s[a]=1}catch(t){r("error",{alias:e.alias,data:t.message}),s[a]=1}var n,i},c=[];for(let e=0;e<i;e+=a)c.push(n.slice(e,e+a));for(const[e,t]of c.entries())await Promise.all(t.map(((t,o)=>l(t,e*a+o))))}return e(100,{type:"success",data:this.get()}),this}}(e)}e.aloneLoader=t,e.default=t,e.getFunHash=a,e.waitSleep=function(e,a){return new Promise((t=>setTimeout((()=>{"function"==typeof a?t(a()):t()}),e)))},Object.defineProperty(e,"__esModule",{value:!0})}));
